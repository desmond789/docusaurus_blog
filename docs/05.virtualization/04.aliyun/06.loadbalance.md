---
title: 6.负载均衡
---
## 阿里云负载均衡简介

* clb：传统负载均衡

  * 支持4层和7层，仅支持对url，域名进行转发
  * clb使用的多
* alb：应用负载均衡

  * 只支持7层，整合了nginx负载均衡各种功能，可以根据用户请求头响应头
  * 如果需要详细处理用户请求之类的操作

![1706445020161](images/1706445020161.png)

## 架构简介

![1706446185953](images/1706446185953.png)

![1706446225372](images/1706446225372.png)

![1706446273122](images/1706446273122.png)

## CLB传统型负载均衡

### 创建2个ECS

再创建一台同样规格和区域的ECS

![1706446620983](images/1706446620983.png)

### 创建CLB

#### 安装nginx

分别在两台ECS上安装nginx

```
sudo dnf install nginx -y

#nginx默认静态页面路径
#更改静态页面内容，便于测试LB
echo $(hostname) > /usr/share/testpage/index.html
```

#### 安全组放行

放行对应的端口，默认时80，我重新设置了8010

#### 创建CLB

搜索SLB > 传统型负载均衡CLB

![1706448909327](images/1706448909327.png)

创建一个CLB

![1706448922482](images/1706448922482.png)

创建成功

![1706449031535](images/1706449031535.png)

#### 配置后端服务器

实例管理 > 添加后端服务器 > 将需要负载均衡的服务器勾选上

![1706449116887](images/1706449116887.png)

#### 添加监听端口

实例管理 > 选择对应的CLB实例 > 监听 >添加监听

![1706449426750](images/1706449426750.png)

添加监听端口

![1706449482210](images/1706449482210.png)

配置成功

![1706449526115](images/1706449526115.png)

### 测试

使用浏览器访问CLB地址，查看显示的页面信息是否不同。可以使用多个浏览器，多刷新几次页面。

如果操作过程中显示不同信息，则说明配成功

![1706449641168](images/1706449641168.png)

## ALB应用型负载均衡

### 创建ALB

应用型负载均衡ALB > 实例 > 创建

![1706450233780](images/1706450233780.png)

![1706450238028](images/1706450238028.png)

创建成功

![1706450295079](images/1706450295079.png)

#### 创建服务器组

应用型负载均衡ALB > 服务器组 > 创建

主要参数：

* VPC：选择和ECS同一网络VPC
* 后端协议：HTTP
* 调度算法：加权轮询

![1706450451272](images/1706450451272.png)

##### 添加后端服务器

应用型负载均衡ALB > 服务器组 > 选择对应服务器组 > 添加后端服务器

![1706450560933](images/1706450560933.png)

![1706450613430](images/1706450613430.png)

#### 添加监听端口

应用型负载均衡ALB > 实例 > 选择对应实例 >添加监听

![1706450675098](images/1706450675098.png)

选择对应服务器组

![1706450707417](images/1706450707417.png)

配置成功

![1706450746231](images/1706450746231.png)

### 测试

使用浏览器访问ALB的公网地址，格式是一个域名，类似以下地址：

```
alb-4ig7k7e8c22el65l5m.cn-shanghai.alb.aliyuncs.com
```

浏览器的地址应该是：

```
http://alb-4ig7k7e8c22el65l5m.cn-shanghai.alb.aliyuncs.com:8010/	#端口是监听设置的端口
```

使用浏览器访问ALB地址，查看显示的页面信息是否不同。可以使用多个浏览器，多刷新几次页面。

如果操作过程中显示不同信息，则说明配成功

![1706450988427](images/1706450988427.png)

### 配置转发规则

该功能是标准功能，上面购买的是基础版，可以将实例升级成标准版，做下面的实验。

应用型负载均衡ALB > 实例 > 选择对应实例 > 查看或编辑转发规则

![1706451503529](images/1706451503529.png)

#### 添加转发规则

转发规则有很多种，HTTP标头只是其中一种，此处只演示HTTP标头。

![1706451726022](images/1706451726022.png)

HTTP标头可以按f12查看页面获取

![1706451842888](images/1706451842888.png)
